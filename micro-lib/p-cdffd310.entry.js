import{r as t,h as s,H as e,g as i,c as n}from"./p-f3648cb0.js";const h=t=>new Promise((s=>{setTimeout((()=>{s("")}),t)})),o=class{constructor(s){t(this,s)}async eventUpdated(t){if(t.detail.name===this.name){for(;void 0===this.element;)await h(1);this.element.innerHTML=t.detail.content,t.preventDefault()}}componentDidRender(){const t=this.el.getElementsByTagName("template")[0].content;this.element=this.el.attachShadow({mode:"open"}),this.element.appendChild(t.cloneNode(!0))}render(){return s(e,null,s("slot",null))}get el(){return i(this)}},r=class{constructor(s){t(this,s),this.newContentEvent=n(this,"new-content",7),this.waitingLoadings=0,this.asyncLoadingCount=0,this.waitingLoadings=this.fallbacks,this.fallbacks>0&&this.startSocketConnection()}startSocketConnection(){void 0!==this.socket&&this.socket.readyState===WebSocket.OPEN||(this.socket=new WebSocket(`${this.streamingurl}?streamid=${this.streamregistername}`),this.socket.onmessage=t=>{const s=JSON.parse(t.data);"NEW_CONTENT"===s.type&&(this.sendNewContentEvent(s.data),this.asyncLoadingCount=this.asyncLoadingCount+1,this.waitingLoadings===this.asyncLoadingCount&&(this.waitingLoadings=0,this.asyncLoadingCount=0,this.socket.close()))})}sendNewContentEvent(t){this.newContentEvent.emit({content:t.value,name:t.key})}async loadNewContent(t){const s=await fetch(`/micro-puzzle?fragment=${t.detail.loading}&frontend=${t.detail.content}&streamid=${this.streamregistername}`),e=await s.json();this.sendNewContentEvent(e),e.isFallback&&(this.startSocketConnection(),this.waitingLoadings=this.waitingLoadings+1)}render(){return s(e,null)}get el(){return i(this)}};export{o as micro_puzzle_element,r as micro_puzzle_loader}